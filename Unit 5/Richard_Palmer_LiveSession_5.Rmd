---
title: "Unit5 PreLive"
author: "Richard Palmer"
date: "9/19/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# get libraries
library(dplyr)
library(ggplot2)
library(plotly)
library(ggalt)
library(ggcorrplot)
library(tidyr)
library(stringr)
```

# Part 1

## Get the data and compute height in inches
```{r}
# load data
raw_ball <- read.csv(file="PlayersBBall.csv")
# convert height to inches, compute years played
BBall <- raw_ball %>% mutate(htc=as.character(height)) %>%
  mutate (TotalInches = 12*as.numeric(str_extract(htc,"^[:digit:]+")) + as.numeric(str_extract(htc,"[:digit:]+$")) )
BBall$position <- as.factor(BBall$position)
```

## histogram of heights
```{r}
BBall %>% drop_na(TotalInches) %>% ggplot(aes(x=TotalInches,color=position)) + 
  geom_histogram() + facet_wrap(~position) + ggtitle('Histograms of Height in inches, by position')
```

# Part 2

## Get the data, drop observations for which we cannot compute height or weight
```{r}
fifa_raw <- read.csv(file='FIFA Players.csv')
FIFA <- fifa_raw %>% mutate(htc=as.character(Height)) %>% mutate(wtc=as.character(Weight)) %>%
  mutate (TotalInches = 12*as.numeric(str_extract(htc,"^[:digit:]+")) + as.numeric(str_extract(htc,"[:digit:]+$")) ) %>%
  mutate (TotalPounds = as.numeric(str_extract(wtc,"^[:digit:]+"))) 
```

## Try a little EDA
```{r}
FIFA %>% drop_na(TotalInches) %>% drop_na(TotalPounds) %>% ggplot(aes(x=TotalInches,y=TotalPounds)) + geom_point() + facet_wrap(~Position)
```

## limit to only LB and LM positions
```{r}
FIFA %>% filter(grepl("(LM|LB)",Position)) %>% drop_na(TotalInches) %>% drop_na(TotalPounds) %>%
  ggplot(aes(x=TotalInches,y=TotalPounds)) + geom_point() + facet_wrap(~Position)
```

# Part 3

## load the data
```{r}
yob2016 <- read.csv(file='yob2016.txt',header=FALSE,sep=";")
names(yob2016) <- c("name","gender","count")
summary(yob2016)
str(yob2016)
```

## Question 1
```{r}
bad <- yob2016 %>% filter(grepl("yyy$",name,ignore.case = TRUE))
as.character(bad$name)
dim(yob2016)[1]
y2016 <- yob2016 %>% filter(!grepl("yyy$",name,ignore.case=TRUE))
dim(y2016)[1]

```

## Question 2

### load the data
```{r}
y2015 <- read.csv(file='yob2015.txt',header=FALSE,sep=',')
names(y2015) <- c("name","gender","count")
tail(y2015,10)
```

It is interesting to note that the last five names all are male, and that they
all have a count of 5.

### join the lists, keeping only names that appear in both years

We want to ignore case, so must change factor to string first, and convert back to Factor after

```{r}
tmp2016 <- y2016 %>% mutate(gender.name = tolower(paste(gender,name,sep="."))) %>% select(gender.name,count)
tmp2015 <- y2015 %>% mutate(gender.name = tolower(paste(gender,name,sep="."))) %>% select(gender.name,count)

final <- inner_join(tmp2015,tmp2016,by="gender.name") %>% 
  separate(col=gender.name,into=c("gender","name"))

dim(y2015)[1]
dim(y2016)[1]
dim(final)[1]
```

## Question 3

### total number of children from both years and sort by the total
```{r}
summed_and_sorted <-  final %>% mutate(Total = count.x + count.y) %>% dplyr::arrange(desc(Total))
```

### top ten names
```{r}
head(summed_and_sorted,10)
```

### top ten girl names
```{r}
top_girls <- summed_and_sorted %>% filter(gender == "f") %>% select(name,Total) %>% head(10)
names(top_girls) = c("Name","Count")
top_girls
write.csv(top_girls,file="PopularGirlNames.csv",quote=FALSE,row.names=FALSE)
```

## Question 4

```{r}
library("poweRlaw")
name_counts <- summed_and_sorted$Total
nc_pl <- displ$new(name_counts)
est = estimate_xmin(nc_pl)
```


