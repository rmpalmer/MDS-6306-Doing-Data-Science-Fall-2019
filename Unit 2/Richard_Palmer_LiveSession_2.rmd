---
title: "Unit 2"
author: "Richard Palmer"
date: "9/2/2019"
output:
  powerpoint_presentation: default
  ioslides_presentation: default
  beamer_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, echo =FALSE}

# need to set this to true for ppt, but false for pdf
knit_echo = TRUE

# get libraries
library(dplyr)
library(ggplot2)
library(plotly)
library(ggalt)
library(ggcorrplot)
library(tidyr)

# helpful function
to_inches <- function(height) {
  vals <- unlist(strsplit(x=height,split='-'))
  feet   <- as.numeric(vals[1])
  inches <-  as.numeric(vals[2])
  return (12*feet + inches)
}

clean_pos <- function(pos) {
  c <-  ""
  if (pos == "C") {
    c <- "Ctr"
  } else if (pos == "F") {
    c <- "For"
  } else if (pos == "G") {
    c <- "Grd"
  } else if ((pos == "C-F") | (pos == "F-C")) {
    c <- "Ctr/For"
  } else if ((pos == "F-G") | (pos == "G-F")) {
    c <- "For/Grd"
  }
  return(c)
}

staying_power <- function(yrs) {
  s <- "1"
  if (yrs >= 20) {
    s <- ">=20"
  } else if (yrs > 15) {
    s <- "15-19"
  } else if (yrs > 10) {
    s <- "10-14"
  } else if (yrs > 5) {
    s <- "5-9"
  } else if (yrs > 1) {
    s <- "2-4"
  }
  return (s)
}

# load data
raw_ball <- read.csv(file="PlayersBBall.csv")

# convert height to inches, compute years played
BBall <- raw_ball %>% rowwise() %>% mutate(htc=as.character(height),height_inches=to_inches(htc)) %>% mutate(years_played = year_end - year_start + 1) %>% mutate(str_posn =clean_pos(position)) %>% mutate(sp = staying_power(years_played))

BBall$position <- as.factor(BBall$str_posn)
BBall$staying  <- as.factor(BBall$sp)
BBall$staying  <- factor(BBall$staying,levels=c("1","2-4","5-9","10-14","15-19",">=20"))

# education data
raw_educ <- read.csv(file="Education_Income.csv")
education <- raw_educ %>% rowwise() %>% mutate(log_income = log(Income2005))

# put the education levels in ascending order
education$Educ <- factor(education$Educ,levels=c("<12","12","13-15","16",">16"))



```
## Question 1
Show the number of players per position
```{r,echo=knit_echo}
BBall %>% filter(position != '')  %>% ggplot() + geom_bar(mapping=aes(x=position)) + ggtitle("Count per position")
```
There are a great many more Guards and Forwards than Centers.

## Question 2
Compare the distribution of weight of centers with that of the weight of forwards
```{r,echo=knit_echo}
BBall %>% filter(position == 'Ctr' | position == 'For') %>% drop_na(weight) %>% ggplot(aes(x=weight)) + geom_histogram(bins=21) + ggtitle("Distribution of Weight for Centers and Forwards") + facet_wrap(~position)

```
Centers seem to be somewhat taller than Forwards.

## Question 3
Compare the distribution of the height of centers with that of the height of forwards
```{r,echo=knit_echo}
BBall %>% filter(position == 'Ctr' | position == 'For') %>% drop_na(height_inches) %>% ggplot(aes(x=height_inches)) + geom_histogram(bins=21) + ggtitle("Distribution of Height for Centers and Forwards") + facet_wrap(~position)
```
Centers are somewhat taller than Forwards.

## Question 4
Investigate distribution of height across all positions
```{r,echo=knit_echo}
BBall %>% filter(position != "") %>% drop_na(height_inches) %>% ggplot(aes(x=height_inches)) + geom_histogram(bins=21) + ggtitle("Distribution of Height for all positions") + facet_wrap(~position)
```
The distribution of height for Centers and Forwards is clearly larger than that of Guards.

## Question 5
Investigate how a players height is related to his weight
```{r,echo=knit_echo}
BBall %>% drop_na(height_inches) %>% drop_na(weight) %>% ggplot(aes(x=weight,y=height_inches)) + geom_point() + ggtitle("Height versus Weight") + geom_jitter()
```
There is clearly a strong, apparently linear relationship between weight and height.  There is more variation in weight for taller players.


## Question 6
Is there any difference in height/weight relationship among positions?
```{r,echo=knit_echo}
BBall %>% drop_na(height_inches) %>% drop_na(weight) %>% ggplot(aes(x=weight,y=height_inches,color=position)) + geom_point() + ggtitle("Height versus Weight") + geom_jitter()
```
It is difficult to identify a different trend of height to weight by position.  It might be that the slope is not so great for Centers as for Guards, but this effect might instead simply be a consequence of taller players being Centers.  

## Question 7
Is there any evidence that height has changed over the years?
```{r,echo=knit_echo}
BBall %>% drop_na(height_inches) %>% drop_na(year_start) %>% ggplot(aes(x=year_start,y=height_inches)) + geom_point() + ggtitle("Height versus starting year") + geom_jitter() + geom_smooth(method="lm")
```
It does appear tha there has been an increase in the range of heights over the years.
## Question 8
3D plot of height versus weight versus year, colored by position
```{r,echo=knit_echo}
#plot_ly(BBall, x=~height_inches,y=~weight,z=~year_start,color=~position,size=1) %>% add_markers %>% layout(scene=list(xaxis=list(title="Height"),yaxis=list(title="Weight"),zaxis=list(title="Start Year")))
```

## Question 9
- Colored by staying power (years played)
```{r,echo=knit_echo}
BBall %>% ggplot(aes(position)) + geom_bar(aes(fill=staying)) + ggtitle("Distribution of staying power (years played), by position")
``` 
The Forwards and Guards are most likely to only play for one year.

## Question 10
Test the claim that the distribution of income increases as the education level rises.
```{r,echo=knit_echo}
education %>% ggplot(aes(x=Educ,y=log_income)) + geom_boxplot()
```
Visualy, it doea appear that the distribution of incomes increases with each successive group.

